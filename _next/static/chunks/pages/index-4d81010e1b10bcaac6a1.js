(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{2521:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return X}});var r,a=n(1508),i=n(266),s=n(2809),o=n(2209),c=n(809),u=n.n(c),l=n(9008),d=n(917),m=n(7294),p=n(387),h=n(5755),f=JSON.parse('{"Mt":[{"inputs":[],"stateMutability":"payable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"string","name":"message","type":"string"},{"indexed":false,"internalType":"string","name":"imageUrl","type":"string"}],"name":"NewWave","type":"event"},{"inputs":[{"internalType":"string","name":"_message","type":"string"},{"internalType":"string","name":"_imageUrl","type":"string"}],"name":"askForArt","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getArtRequests","outputs":[{"components":[{"internalType":"address","name":"waver","type":"address"},{"internalType":"string","name":"message","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"imageUrl","type":"string"}],"internalType":"struct WavePortal.Wave[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalArtRequests","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastWavedAt","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]}'),g=n(1735);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=["100","101","102","103","200","201","202","203","204","205","206","207","208","226","300","301","302","303","304","305","306","307","308","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","421","422","423","424","425","426","427","428","429","430","431","451","500","501","502","503","504","505","506","507","508","509","510","511"],w="0xD0F1A318b25149093bb1C8568B392970cA184631",x=f.Mt,k=(0,d.F4)(r||(r=(0,o.Z)(["\n  from {\n  \topacity: 0;\n  }\n  to {\n \topacity: 1;\n  }\n"]))),Z={opacity:1,"@media screen and (prefers-reduced-motion: no-preference)":{animation:"".concat(k," 2.5s ease-in-out infinite")}},T="Missing the Metamask browser extension, or if on mobile, open the app in the Metamask app's browser.";function M(e){switch(e.state){case"mining":return v(v({},Z),{},{marginRight:"0.5rem"});case"mined":return{marginRight:"0.5rem"};case"none":return{display:"none"}}}function S(e){var t=e.state;switch(console.dir(e),t){case"mining":return"Mining transaction";case"mined":return"Transaction has been mined"}}var O=function(e){var t=e.children,n=(e.onClick,e.type),r=void 0===n?"button":n;return(0,g.tZ)("button",{type:r,sx:{backgroundColor:"accent",color:"#fff",borderRadius:"0.5rem",border:"none",padding:"0.25rem 0.5rem"},children:t})},X=function(){var e=(0,m.useState)(""),t=e[0],n=e[1],r=(0,m.useState)(""),s=r[0],o=r[1],c=(0,m.useState)(""),d=c[0],f=c[1],y=(0,m.useState)(""),k=y[0],Z=y[1],X=(0,m.useState)(""),q=X[0],B=X[1],W=(0,m.useState)([]),C=W[0],_=W[1],A=(0,m.useState)({state:"none"}),P=A[0],j=A[1],N=(0,m.useRef)(null);function R(){return D.apply(this,arguments)}function D(){return(D=(0,i.Z)(u().mark((function e(){var t,n,r,i,s,o,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=window,!(n=t.ethereum)){e.next=14;break}return r=new h.Q(n),i=r.getSigner(),s=new p.CH(w,x,i),e.next=8,s.getArtRequests();case 8:o=e.sent,c=o.map((function(e){return{address:e.waver,timestamp:new Date(1e3*e.timestamp),message:e.message,imageUrl:e.imageUrl}})),_(c),s.on("NewWave",(function(e,t,n,r){console.log("NewWave",e,t,n,r),_((function(i){return[].concat((0,a.Z)(i),[{address:e,timestamp:new Date(1e3*t),message:n,imageUrl:r}])})),B(n)})),e.next=15;break;case 14:console.log("Ethereum object doesn't exist!");case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}function E(){o(""),f("")}function U(e){var t=new h.Q(e).getSigner();return new p.CH(w,x,t)}function F(){return(F=(0,i.Z)(u().mark((function e(t){var n,r,a,i,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault,E(),k&&0!==k.length){e.next=6;break}return o("You need to specify a message before requesting to view art"),setTimeout((function(){o("")}),3e3),e.abrupt("return");case 6:if(e.prev=6,n=window,!(r=n.ethereum)){e.next=20;break}return a=U(r),i="https://http.cat/".concat(b[Math.floor(Math.random()*b.length-1)]),e.next=13,a.askForArt(k,i);case 13:return s=e.sent,j({state:"mining",transactionHash:s.hash}),e.next=17,s.wait();case 17:j({state:"mined",transactionHash:s.hash}),e.next=21;break;case 20:o(T);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(6),e.t0.message.includes("MetaMask Tx Signature: User denied transaction signature.")?o("You changed your mind and did not request to see a picture. \ud83d\ude2d"):e.t0.message.includes("execution reverted: Wait 15m")?o("Please don't spam. You can send another message after 15 minutes."):e.t0.message.includes("Cannot estimate gas; transaction may fail or may require manual gas limit")?o("Cannot estimate gas; transaction may fail or may require manual gas limit."):o("Trying to withdraw more money than the contract has");case 26:return e.prev=26,setTimeout((function(){j({state:"none"})}),3e3),Z(""),e.finish(26);case 30:case"end":return e.stop()}}),e,null,[[6,23,26,30]])})))).apply(this,arguments)}function Y(){return(Y=(0,i.Z)(u().mark((function e(){var t,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E(),e.prev=1,t=window,r=t.ethereum){e.next=6;break}return o(T),e.abrupt("return");case 6:return e.next=8,r.request({method:"eth_requestAccounts"});case 8:a=e.sent,n(a[0]),R(),o(""),f("Wallet ".concat(a[0]," has been connected")),setTimeout((function(){f("")}),3e3),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0),e.t0.message.includes("Request of type 'wallet_requestPermissions' already pending")?o("You've already requested to connect your Metamask wallet. Click on the Metamask wallet extension to bring it back to focus so you can connect your wallet."):e.t0.message.includes("User rejected the request.")?o("That's so sad. You decided to not connect your wallet. \ud83d\ude2d"):o("An unknown error occurred");case 20:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}var H=function(){var e=(0,i.Z)(u().mark((function e(t){var r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.request({method:"eth_accounts"});case 3:0!==(r=e.sent).length?(a=r[0],console.log("Found an authorized account:",a),n(a)):o("No authorized account found. Connect your account in your Metamask wallet."),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return(0,m.useEffect)((function(){var e=window.ethereum;e?(H(e),R()):o(T)}),[]),(0,g.BX)(g.HY,{children:[(0,g.BX)(l.default,{children:[(0,g.tZ)("title",{children:"Welcome to the Picture Portal \ud83d\udcf7"}),(0,g.tZ)("meta",{name:"description",content:"Welcome to Web3"}),(0,g.tZ)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,g.BX)("header",{sx:{margin:"1rem 0"},children:[(0,g.BX)("marquee",{sx:{fontSize:"2rem",background:"#000",color:"lime",padding:"0.5rem"},children:[C.length," picture requests! \ud83d\udca5"]}),(0,g.BX)("h1",{sx:{fontFamily:"heading"},children:["Welcome to the ",(0,g.tZ)("span",{sx:{color:"accent"},children:"picture portal \ud83d\udcf7"})]})]}),(0,g.BX)("main",{children:[(0,g.BX)("p",{children:[(0,g.tZ)("em",{children:"Hi! \ud83d\udc4b"})," I'm Nick. Connect your Metamask Ethereum wallet and request to see some pictures! (not purchase an NFT). Note that this is a test dApp."]}),(0,g.BX)("div",{sx:{display:"flex",flexDirection:"column",marginBottom:"1rem"},children:[(0,g.tZ)("div",{sx:{margin:"1rem 0"},children:t?(0,g.BX)("span",{sx:{background:"#000",color:"lime",fontWeight:500,padding:"0.5rem",borderRadius:"0.5rem",marginRight:"0.5rem"},children:["Account: ",t]}):(0,g.tZ)(O,{onClick:function(){return Y.apply(this,arguments)},children:"Connect Wallet"})}),(0,g.BX)("form",{onSubmit:function(e){null===e||void 0===e||e.preventDefault()},children:[(0,g.tZ)("input",{required:!0,type:"text",value:k,placeholder:"Message",onChange:function(e){return Z(e.target.value)},sx:{marginRight:"0.5rem"}}),(0,g.tZ)(O,{onClick:function(e){return F.apply(this,arguments)},children:"Send message"})]})]}),(0,g.BX)("div",{sx:{height:"2rem"},children:[q&&(0,g.BX)("div",{"aria-live":"polite",sx:{fontWeight:700},children:[(0,g.tZ)("span",{sx:{marginRight:"0.5rem"},children:q}),(0,g.tZ)(O,{onClick:function(){var e=N.current;null===e||void 0===e||e.setAttribute("open","true"),null===e||void 0===e||e.scrollIntoView({behavior:"smooth"})},children:"Go to new message"})]}),s&&(0,g.tZ)("p",{"aria-live":"assertive",sx:{color:"darkred",fontWeight:700},children:s}),d&&(0,g.tZ)("p",{"aria-live":"polite",sx:{color:"darkgreen",fontWeight:700},children:d}),"none"!==P.state&&(0,g.BX)("p",{"aria-live":"polite",sx:{color:"darkgreen",fontWeight:700},children:[(0,g.tZ)("span",{"aria-hidden":"true",sx:M(P),children:"\ud83d\udc8e"}),S(P)]})]}),C.length>0&&(0,g.tZ)("ul",{sx:{listStyle:"none",overflowX:"hidden",overflowY:"scroll",height:"50vh",padding:"1rem","& li":{borderRadius:"0.5rem",backgroundImage:"linear-gradient(to right top, #d8ff10, #ffb900, #ff5843, #ff0099, #c312eb)",padding:"1rem"},"& details":{cursor:"pointer",display:"flex",flexDirection:"column",fontWeight:500,padding:"1rem",background:"#000",color:"#fff",borderRadius:"0.5rem"},"& li + li":{marginTop:"1rem"}},children:C.map((function(e,t,n){var r=t===n.length-1?{ref:N,id:"message".concat(t)}:{};return(0,g.tZ)("li",{children:(0,g.BX)("details",v(v({},r),{},{children:[(0,g.tZ)("summary",{sx:{userSelect:"none"},children:e.message}),(0,g.BX)("p",{children:["Address: ",e.address]}),(0,g.BX)("p",{children:["Message: ",e.message]}),(0,g.tZ)("time",{dateTime:e.timestamp.toString(),children:e.timestamp.toString()}),(0,g.tZ)("img",{src:e.imageUrl,alt:"Art for this request",width:"375",height:"300"})]}))},t)}))})]}),(0,g.tZ)("footer",{children:(0,g.tZ)("nav",{children:(0,g.BX)("ul",{sx:{listStyle:"none",display:"flex",margin:0,justifyContent:"space-between","& li + li":{paddingLeft:"1rem"}},children:[(0,g.tZ)("li",{children:(0,g.tZ)("a",{href:"https://github.com/nickytonline/picture-portal",children:"source code"})}),(0,g.tZ)("li",{children:(0,g.tZ)("a",{href:"https://timeline.iamdeveloper.com",children:"more about Nick"})})]})})})]})}},5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2521)}])},6601:function(){}},function(e){e.O(0,[645,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);